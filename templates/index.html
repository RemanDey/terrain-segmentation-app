<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terrain Segmentation — AeroXMD</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg:      #060a12;
            --panel:   #0d1220;
            --panel2:  #111827;
            --border:  rgba(56,189,248,0.12);
            --border2: rgba(56,189,248,0.28);
            --sky:     #38bdf8;
            --lime:    #a3e635;
            --amber:   #fbbf24;
            --rose:    #fb7185;
            --text:    #e2e8f0;
            --muted:   #64748b;
            --radius:  12px;
        }

        html { scroll-behavior: smooth; }

        body {
            background: var(--bg);
            background-image:
                radial-gradient(ellipse 70% 50% at 15% -5%,  rgba(56,189,248,0.09) 0%, transparent 55%),
                radial-gradient(ellipse 50% 40% at 85% 100%, rgba(163,230,53,0.06)  0%, transparent 55%);
            font-family: 'Outfit', sans-serif;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body::before {
            content: '';
            position: fixed; inset: 0; z-index: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.025) 2px, rgba(0,0,0,0.025) 4px);
            pointer-events: none;
        }

        /* ════ NAV ════ */
        nav {
            position: relative; z-index: 10;
            display: flex; align-items: center; justify-content: space-between;
            padding: 18px 40px;
            border-bottom: 1px solid var(--border);
            background: rgba(6,10,18,0.65);
            backdrop-filter: blur(14px);
        }

        .nav-logo {
            font-family: 'Syne', sans-serif;
            font-weight: 800; font-size: 17px; letter-spacing: -0.02em;
            color: #fff; display: flex; align-items: center; gap: 10px;
        }

        .logo-icon {
            width: 30px; height: 30px;
            background: linear-gradient(135deg, var(--sky), var(--lime));
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
        }
        .logo-icon svg { width: 16px; height: 16px; fill: #060a12; }

        .nav-pill {
            font-family: 'JetBrains Mono', monospace; font-size: 10px;
            letter-spacing: 0.1em; color: var(--muted);
            background: var(--panel2); border: 1px solid var(--border);
            padding: 4px 12px; border-radius: 100px;
        }

        .nav-status {
            display: flex; align-items: center; gap: 6px;
            font-size: 11px; color: var(--muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .status-dot {
            width: 7px; height: 7px; border-radius: 50%;
            background: var(--lime); box-shadow: 0 0 8px var(--lime);
            animation: blink 2.2s ease infinite;
        }

        /* ════ MAIN ════ */
        main {
            position: relative; z-index: 1; flex: 1;
            display: flex; flex-direction: column; align-items: center;
            padding: 44px 24px 64px; gap: 32px;
        }

        .page-head {
            text-align: center;
            animation: fadeUp 0.55s ease both;
        }

        .page-head h1 {
            font-family: 'Syne', sans-serif;
            font-size: clamp(26px, 5vw, 44px);
            font-weight: 800; letter-spacing: -0.03em; line-height: 1.1; color: #fff;
        }

        .page-head h1 em {
            font-style: normal;
            background: linear-gradient(90deg, var(--sky), var(--lime));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .page-head p {
            margin-top: 10px; font-size: 15px; color: var(--muted);
            font-weight: 300; max-width: 480px; margin-left: auto; margin-right: auto;
        }

        /* ════ UPLOAD CARD ════ */
        .upload-card {
            width: 100%; max-width: 620px;
            background: var(--panel); border: 1px solid var(--border);
            border-radius: 20px; padding: 28px;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.03), 0 24px 60px rgba(0,0,0,0.5);
            animation: fadeUp 0.55s 0.08s ease both;
        }

        .section-label {
            font-family: 'JetBrains Mono', monospace; font-size: 10px;
            letter-spacing: 0.14em; text-transform: uppercase;
            color: var(--sky); margin-bottom: 16px;
            display: flex; align-items: center; gap: 8px;
        }
        .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

        .drop-zone {
            border: 1.5px dashed rgba(56,189,248,0.3); border-radius: var(--radius);
            padding: 34px 20px; text-align: center; cursor: pointer;
            transition: all 0.25s; background: rgba(56,189,248,0.025);
            position: relative; overflow: hidden; display: block;
        }
        .drop-zone::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at center, rgba(56,189,248,0.07), transparent 70%);
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        .drop-zone:hover, .drop-zone.drag-over { border-color: var(--sky); background: rgba(56,189,248,0.06); }
        .drop-zone:hover::before, .drop-zone.drag-over::before { opacity: 1; }

        .drop-icon {
            width: 54px; height: 54px; margin: 0 auto 14px;
            background: rgba(56,189,248,0.08); border: 1px solid rgba(56,189,248,0.2);
            border-radius: 16px; display: flex; align-items: center; justify-content: center;
            transition: transform 0.25s, background 0.25s;
        }
        .drop-zone:hover .drop-icon { transform: translateY(-4px); background: rgba(56,189,248,0.16); }
        .drop-icon svg { width: 26px; height: 26px; stroke: var(--sky); }

        .drop-title { font-size: 15px; font-weight: 500; color: #fff; margin-bottom: 6px; }
        .drop-hint  { font-size: 12px; color: var(--muted); }
        .drop-hint strong { color: var(--sky); font-weight: 500; }
        input[type="file"] { display: none; }

        .file-meta {
            display: none; align-items: center; gap: 10px;
            margin-top: 14px; padding: 10px 14px;
            background: var(--panel2); border: 1px solid var(--border); border-radius: 10px;
            font-size: 12px;
        }
        .file-meta svg { stroke: var(--lime); flex-shrink: 0; }
        .meta-name { flex: 1; color: var(--text); font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .meta-size { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--lime); }
        .meta-clear {
            width: 24px; height: 24px; border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.08); background: transparent;
            color: var(--muted); font-size: 16px; line-height: 1; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .meta-clear:hover { color: var(--rose); border-color: rgba(251,113,133,0.3); }

        .btn-submit {
            margin-top: 18px; width: 100%; padding: 13px; border: none; border-radius: 10px;
            font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 600; color: #060a12;
            background: linear-gradient(135deg, var(--sky), var(--lime));
            cursor: pointer; transition: all 0.22s;
            box-shadow: 0 4px 20px rgba(56,189,248,0.28);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-submit:hover { box-shadow: 0 6px 30px rgba(56,189,248,0.42); transform: translateY(-1px); }
        .btn-submit:active { transform: scale(0.98); }
        .btn-submit:disabled { opacity: 0.38; cursor: not-allowed; transform: none; box-shadow: none; }

        .spinner {
            display: none; width: 16px; height: 16px;
            border: 2.5px solid rgba(6,10,18,0.25); border-top-color: #060a12;
            border-radius: 50%; animation: spin 0.65s linear infinite;
        }
        .btn-submit.loading .spinner { display: block; }
        .btn-submit.loading .btn-label { opacity: 0.7; }

        /* ════ RESULTS SECTION ════ */
        .results-section {
            width: 100%; max-width: 1120px;
            animation: fadeUp 0.55s 0.12s ease both;
        }

        .results-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 18px; flex-wrap: wrap; gap: 12px;
        }

        .results-title {
            font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; color: #fff;
        }
        .results-title span {
            font-family: 'JetBrains Mono', monospace; font-size: 11px;
            font-weight: 400; color: var(--lime); margin-left: 10px;
        }

        .view-toggle { display: flex; gap: 6px; }

        .toggle-btn {
            padding: 7px 14px; border-radius: 8px;
            border: 1px solid var(--border); background: transparent;
            color: var(--muted); font-family: 'JetBrains Mono', monospace;
            font-size: 11px; letter-spacing: 0.06em; cursor: pointer; transition: all 0.2s;
        }
        .toggle-btn.active, .toggle-btn:hover {
            background: rgba(56,189,248,0.1); border-color: rgba(56,189,248,0.35); color: var(--sky);
        }

        /* ── Side by side ── */
        .side-by-side { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

        .img-panel {
            background: var(--panel); border: 1px solid var(--border); border-radius: 18px;
            overflow: hidden; transition: border-color 0.25s, box-shadow 0.25s;
        }
        .img-panel:hover { border-color: var(--border2); box-shadow: 0 0 30px rgba(56,189,248,0.07); }

        .panel-head {
            display: flex; align-items: center; justify-content: space-between;
            padding: 13px 16px; border-bottom: 1px solid var(--border);
        }

        .panel-tag {
            display: flex; align-items: center; gap: 8px;
            font-family: 'JetBrains Mono', monospace; font-size: 11px;
            letter-spacing: 0.1em; text-transform: uppercase;
        }

        .tag-dot { width: 8px; height: 8px; border-radius: 50%; }
        .tag-dot.sky  { background: var(--sky);  box-shadow: 0 0 8px var(--sky); }
        .tag-dot.lime { background: var(--lime); box-shadow: 0 0 8px var(--lime); }

        .panel-acts { display: flex; gap: 6px; }

        .icon-btn {
            width: 28px; height: 28px; background: var(--panel2);
            border: 1px solid var(--border); border-radius: 7px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; text-decoration: none;
        }
        .icon-btn:hover { background: rgba(56,189,248,0.1); border-color: rgba(56,189,248,0.3); }
        .icon-btn svg { stroke: var(--muted); transition: stroke 0.2s; }
        .icon-btn:hover svg { stroke: var(--sky); }

        .panel-img {
            position: relative; background: #080d18; aspect-ratio: 4/3; overflow: hidden;
        }
        .panel-img img {
            width: 100%; height: 100%; object-fit: cover; display: block;
            transition: transform 0.4s ease;
        }
        .img-panel:hover .panel-img img { transform: scale(1.03); }

        .img-chip {
            position: absolute; bottom: 12px; left: 12px;
            background: rgba(6,10,18,0.76); backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.08); border-radius: 8px;
            padding: 5px 10px; font-family: 'JetBrains Mono', monospace;
            font-size: 10px; letter-spacing: 0.08em; color: var(--muted);
            display: flex; align-items: center; gap: 5px;
        }
        .chip-dot { width: 5px; height: 5px; border-radius: 50%; }

        .panel-foot {
            padding: 12px 16px; border-top: 1px solid var(--border);
            display: flex; align-items: center; gap: 8px;
            font-size: 12px; color: var(--muted);
        }
        .panel-foot svg { stroke: var(--muted); flex-shrink: 0; }

        /* ── Slider view ── */
        .slider-view {
            display: none; background: var(--panel);
            border: 1px solid var(--border); border-radius: 18px; overflow: hidden;
        }
        .slider-view .panel-head { border-bottom: 1px solid var(--border); }

        .slider-wrap {
            position: relative; aspect-ratio: 16/9; overflow: hidden;
            background: #080d18; cursor: col-resize; user-select: none;
        }

        .sl-back { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: block; }

        .sl-front-wrap {
            position: absolute; top: 0; left: 0; height: 100%; width: 50%;
            overflow: hidden;
        }
        .sl-front {
            position: absolute; top: 0; left: 0;
            height: 100%; width: 100%; object-fit: cover; object-position: left top;
        }

        .sl-handle {
            position: absolute; top: 0; left: 50%;
            transform: translateX(-50%); height: 100%; width: 3px;
            background: rgba(255,255,255,0.9); box-shadow: 0 0 14px rgba(255,255,255,0.5);
            z-index: 10; cursor: col-resize;
        }

        .sl-knob {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 42px; height: 42px; background: #fff; border-radius: 50%;
            box-shadow: 0 2px 18px rgba(0,0,0,0.55);
            display: flex; align-items: center; justify-content: center;
        }
        .sl-knob svg { width: 18px; height: 18px; stroke: #060a12; }

        .sl-label {
            position: absolute; top: 12px; z-index: 20; pointer-events: none;
            background: rgba(6,10,18,0.76); backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px;
            font-family: 'JetBrains Mono', monospace; font-size: 10px; letter-spacing: 0.08em;
        }
        .sl-label.left  { left: 12px;  color: var(--lime); }
        .sl-label.right { right: 12px; color: var(--sky);  }

        /* ── Stats ── */
        .stats-row {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 14px;
        }

        .stat {
            background: var(--panel); border: 1px solid var(--border); border-radius: 14px;
            padding: 16px; text-align: center; transition: border-color 0.25s;
        }
        .stat:hover { border-color: var(--border2); }

        .stat-val {
            font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 800; color: #fff;
        }
        .stat-lbl {
            font-family: 'JetBrains Mono', monospace; font-size: 10px;
            letter-spacing: 0.1em; color: var(--muted); margin-top: 4px;
        }

        /* ── Legend ── */
        .legend {
            background: var(--panel); border: 1px solid var(--border); border-radius: 14px;
            padding: 15px 20px; margin-top: 14px;
            display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
        }
        .legend-title {
            font-family: 'JetBrains Mono', monospace; font-size: 10px;
            letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
        }
        .legend-items { display: flex; gap: 14px; flex-wrap: wrap; }
        .legend-item  { display: flex; align-items: center; gap: 7px; font-size: 13px; color: var(--text); }
        .legend-swatch { width: 11px; height: 11px; border-radius: 3px; }

        /* ════ FOOTER ════ */
        footer {
            position: relative; z-index: 1;
            border-top: 1px solid var(--border);
            padding: 18px 40px;
            display: flex; align-items: center; justify-content: center; gap: 16px;
            font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--muted);
        }
        footer b { color: var(--sky); font-weight: 500; }

        /* ════ ANIMATIONS ════ */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes blink {
            0%, 100% { opacity: 1; } 50% { opacity: 0.3; }
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ════ RESPONSIVE ════ */
        @media (max-width: 700px) {
            nav { padding: 14px 16px; }
            .nav-pill { display: none; }
            .side-by-side { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

<!-- NAV -->
<nav>
    <div class="nav-logo">
        <div class="logo-icon">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22" fill="none" stroke="#060a12" stroke-width="2"/></svg>
        </div>
        AeroXMD
    </div>
    <div class="nav-pill">TERRAIN · AI · VISION</div>
    <div class="nav-status">
        <div class="status-dot"></div>
        System Online
    </div>
</nav>

<!-- MAIN -->
<main>

    <!-- Heading -->
    <div class="page-head">
        <h1>Terrain <em>Segmentation</em></h1>
        <p>Upload aerial imagery to identify and classify terrain regions with deep-learning precision.</p>
    </div>

    <!-- Upload -->
    <div class="upload-card">
        <div class="section-label">01 · Upload Image</div>

        <form method="POST" enctype="multipart/form-data" id="uploadForm">
         

            <label class="drop-zone" id="dropZone" for="imageInput">
                <div class="drop-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="16 16 12 12 8 16"/>
                        <line x1="12" y1="12" x2="12" y2="21"/>
                        <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/>
                    </svg>
                </div>
                <div class="drop-title">Drop aerial image here</div>
                <div class="drop-hint"><strong>Browse file</strong> &nbsp;or drag &amp; drop &nbsp;·&nbsp; PNG · JPG · TIFF · up to 50 MB</div>
                <input type="file" id="imageInput" name="image" accept="image/*" required>
            </label>

            <div class="file-meta" id="fileMeta">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                <span class="meta-name" id="metaName">—</span>
                <span class="meta-size" id="metaSize">—</span>
                <button type="button" class="meta-clear" id="clearBtn">×</button>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn" disabled>
                <div class="spinner"></div>
                <span class="btn-label">Run Segmentation</span>
            </button>
        </form>
    </div>

    <!-- Results — shown after segmentation -->
    {% if output_image %}
    <div class="results-section">

        <div class="results-header">
            <div class="results-title">
                Analysis Results <span>✓ COMPLETE</span>
            </div>
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="setView('side')"  id="btnSide">Side by Side</button>
                <button class="toggle-btn"        onclick="setView('slider')" id="btnSlider">Slider</button>
            </div>
        </div>

        <!-- ── SIDE BY SIDE ── -->
        <div class="side-by-side" id="viewSide">

            <!-- Input -->
            <div class="img-panel">
                <div class="panel-head">
                    <div class="panel-tag">
                        <div class="tag-dot sky"></div>
                        <span style="color:var(--sky)">Input Image</span>
                    </div>
                    <div class="panel-acts">
                        <button class="icon-btn" id="dlInput" title="Download input">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="panel-img">
                    <img id="inputImg" src="{{ url_for('static', filename=input_image) }}" alt="Input image">
                    <div class="img-chip">
                        <div class="chip-dot" style="background:var(--sky);box-shadow:0 0 6px var(--sky)"></div>
                        RAW INPUT
                    </div>
                </div>
                <div class="panel-foot">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <span id="inputLabel">Aerial / satellite image</span>
                </div>
            </div>

            <!-- Output -->
            <div class="img-panel">
                <div class="panel-head">
                    <div class="panel-tag">
                        <div class="tag-dot lime"></div>
                        <span style="color:var(--lime)">Segmentation Mask</span>
                    </div>
                    <div class="panel-acts">
                        <a class="icon-btn" href="{{ url_for('static', filename=output_image) }}" download title="Download mask">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="panel-img">
                    <img src="{{ url_for('static', filename=output_image) }}" alt="Segmentation mask">
                    <div class="img-chip">
                        <div class="chip-dot" style="background:var(--lime);box-shadow:0 0 6px var(--lime)"></div>
                        AI MASK
                    </div>
                </div>
                <div class="panel-foot">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    <span>Segmentation processed successfully</span>
                </div>
            </div>
        </div>

        <!-- ── SLIDER VIEW ── -->
        <div class="slider-view" id="viewSlider">
            <div class="panel-head">
                <div class="panel-tag">
                    <div class="tag-dot sky"></div>
                    <span style="color:#fff">Drag to compare Input vs Mask</span>
                </div>
            </div>
            <div class="slider-wrap" id="sliderWrap">
                <img class="sl-back" src="{{ url_for('static', filename=output_image) }}" alt="Mask">
                <div class="sl-front-wrap" id="slFrontWrap">
                    <img class="sl-front" id="slFront" src="{{ url_for('static', filename=input_image) }}" alt="Input">
                </div>
                <div class="sl-handle" id="slHandle">
                    <div class="sl-knob">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"/>
                            <polyline points="21 18 15 12 21 6"/>
                        </svg>
                    </div>
                </div>
                <div class="sl-label left">MASK</div>
                <div class="sl-label right">INPUT</div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-row">
            <div class="stat">
                <div class="stat-val" style="color:var(--lime)">✓</div>
                <div class="stat-lbl">PROCESSED</div>
            </div>
            <div class="stat">
                <div class="stat-val" style="color:var(--sky)">DL</div>
                <div class="stat-lbl">DEEP LEARNING</div>
            </div>
            <div class="stat">
                <div class="stat-val" style="color:var(--amber)">DINOv2</div>
                <div class="stat-lbl">AI Computer Vision Research</div>
            </div>
            <div class="stat">
                <div class="stat-val" style="color:var(--rose)">CV</div>
                <div class="stat-lbl">Computer Vision</div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <span class="legend-title">Terrain Classes</span>
            <div class="legend-items">
                <div class="legend-item"><div class="legend-swatch" style="background:#006400"></div> Trees</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#32cd32"></div> Lush Bushes</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#dac308"></div> Dry Grass</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#6b541e"></div> Dry Bushes</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#8b5a2b"></div> Ground Clutter</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#c88b32"></div> Flowers</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#a06e3c"></div> Logs</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#8c8c91"></div> Rocks</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#78481e"></div> Landscape</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#aadcff"></div> Sky</div>

            </div>
        </div>

    </div>
    {% endif %}

</main>

<footer>
    <b>AeroXMD</b> · Terrain AI · v2.0 &nbsp;|&nbsp; Indian Institute of Technology Mandi &nbsp;|&nbsp; Developed by Team AeroXMD for KrackHack 2026
</footer>

<script>
/* ─── Upload & Preview ─── */
const input     = document.getElementById('imageInput');
const dropZone  = document.getElementById('dropZone');
const fileMeta  = document.getElementById('fileMeta');
const metaName  = document.getElementById('metaName');
const metaSize  = document.getElementById('metaSize');
const clearBtn  = document.getElementById('clearBtn');
const submitBtn = document.getElementById('submitBtn');
const form      = document.getElementById('uploadForm');
const inputImg  = document.getElementById('inputImg');
const slFront   = document.getElementById('slFront');
const inputLabel = document.getElementById('inputLabel');
const dlInput   = document.getElementById('dlInput');

let currentDataUrl = null;

function fmt(b) {
    if (b < 1024)    return b + ' B';
    if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
    return (b/1048576).toFixed(2) + ' MB';
}

function loadFile(file) {
    if (!file || !file.type.startsWith('image/')) return;
    const r = new FileReader();
    r.onload = e => {
        currentDataUrl = e.target.result;
        fileMeta.style.display = 'flex';
        metaName.textContent   = file.name;
        metaSize.textContent   = fmt(file.size);
        submitBtn.disabled     = false;
        if (inputImg)  { inputImg.src = currentDataUrl; }
        if (slFront)   { slFront.src  = currentDataUrl; }
        if (inputLabel){ inputLabel.textContent = file.name; }
    };
    r.readAsDataURL(file);
}

input.addEventListener('change', () => loadFile(input.files[0]));

clearBtn.addEventListener('click', e => {
    e.preventDefault();
    input.value = ''; currentDataUrl = null;
    fileMeta.style.display = 'none';
    submitBtn.disabled = true;
    if (inputImg)  inputImg.src = '';
    if (slFront)   slFront.src  = '';
});

if (dlInput) {
    dlInput.addEventListener('click', () => {
        if (!currentDataUrl) return;
        const a = document.createElement('a');
        a.href = currentDataUrl;
        a.download = metaName.textContent || 'input.png';
        a.click();
    });
}

/* Drag & drop */
dropZone.addEventListener('dragover',  e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', ()  => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => {
    e.preventDefault(); dropZone.classList.remove('drag-over');
    const f = e.dataTransfer.files[0];
    if (f) { const dt = new DataTransfer(); dt.items.add(f); input.files = dt.files; loadFile(f); }
});

form.addEventListener('submit', () => {
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    submitBtn.querySelector('.btn-label').textContent = 'Processing…';
});

/* ─── View Toggle ─── */
function setView(v) {
    const side   = document.getElementById('viewSide');
    const slider = document.getElementById('viewSlider');
    const bS = document.getElementById('btnSide');
    const bL = document.getElementById('btnSlider');
    if (!side || !slider) return;
    if (v === 'side') {
        side.style.display   = 'grid';
        slider.style.display = 'none';
        bS.classList.add('active');   bL.classList.remove('active');
    } else {
        side.style.display   = 'none';
        slider.style.display = 'block';
        bS.classList.remove('active'); bL.classList.add('active');
    }
}

/* ─── Slider ─── */
const sliderWrap   = document.getElementById('sliderWrap');
const slFrontWrap  = document.getElementById('slFrontWrap');
const slHandle     = document.getElementById('slHandle');

if (sliderWrap) {
    let dragging = false;

    function slide(clientX) {
        const r   = sliderWrap.getBoundingClientRect();
        let pct   = ((clientX - r.left) / r.width) * 100;
        pct = Math.max(1, Math.min(99, pct));
        slFrontWrap.style.width = pct + '%';
        slHandle.style.left     = pct + '%';
    }

    sliderWrap.addEventListener('mousedown',  e => { dragging = true; slide(e.clientX); });
    window.addEventListener('mousemove', e => { if (dragging) slide(e.clientX); });
    window.addEventListener('mouseup',   ()  => dragging = false);

    sliderWrap.addEventListener('touchstart',  e => { dragging = true; slide(e.touches[0].clientX); }, { passive: true });
    window.addEventListener('touchmove', e => { if (dragging) slide(e.touches[0].clientX); }, { passive: true });
    window.addEventListener('touchend',  ()  => dragging = false);
}
</script>

</body>
</html>